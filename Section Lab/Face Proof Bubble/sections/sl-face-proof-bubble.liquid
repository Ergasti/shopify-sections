{% comment %}
  Section Lab - Face Proof Bubble
  Source: Section Lab (paid bundle). Internal use only.
  Overlapping circular images + text; optional verification badge. Can be injected into product info via Custom Liquid.
{% endcomment %}

{% assign images = '' %}
{% assign indexes = '' %}
{% for i in (1..3) %}
  {% assign image_id = 'image_' | append: i %}
  {% if section.settings[image_id] != blank %}
    {% assign images = images | append: section.settings[image_id] | append: ',' %}
    {% assign indexes = indexes | append: i | append: ',' %}
  {% endif %}
{% endfor %}
{% assign index_list = indexes | split: ',' %}
{% assign last_index = '' %}
{% for index in index_list %}
  {% unless index == blank %}
    {% assign last_index = index %}
    {% assign last_index = last_index | plus: 0 %}
  {% endunless %}
{% endfor %}

<div
  id="sl-face-proof-bubble-{{ section.id }}"
  class="sl-overlap-section {{ section.settings.align_mobile }} {{ section.settings.align_desktop }}"
  style="margin: {{ section.settings.space_top }}px {{ section.settings.space_sides }}px {{ section.settings.space_bottom }}px {{ section.settings.space_sides }}px;"
>
  <div
    class="sl-overlap-container"
    style="background-color: {{ section.settings.bg_color }}; border-radius: {{ section.settings.border_radius }}px; border: {{ section.settings.border_width }}px solid {{ section.settings.border_color }};"
  >
    <div class="sl-overlap-images">
      {% for i in (1..3) %}
        {% assign image_id = 'image_' | append: i %}
        {% assign img = section.settings[image_id] %}
        {% if img != blank %}
          {% assign border_color_id = 'img_' | append: i | append: '_border_color' %}
          {% assign border_width_id = 'img_' | append: i | append: '_border_width' %}
          {% assign border_color = section.settings[border_color_id] %}
          {% assign border_width = section.settings[border_width_id] %}

          <div
            class="sl-overlap-img"
            style="
              z-index: {{ i }};
              margin-left: {% if forloop.first %}0{% else %}-10%{% endif %};
              border: {{ border_width }}px solid {{ border_color }};
              width: {{ section.settings.image_size }}px;
              height: {{ section.settings.image_size }}px;
            "
          >
            <img
              src="{{ img | image_url: width: 256 }}"
              alt=""
              loading="lazy"
              width="{{ section.settings.image_size }}"
              height="{{ section.settings.image_size }}"
              style="border-radius: 50%; object-fit: cover; width: 100%; height: 100%;"
            >
            {% if section.settings.verification_badge and i == last_index %}
              <div
                class="sl-verify-badge"
                style="color: {{ section.settings.badge_color }}; width: 24px; height: 24px; z-index: 2;"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                  <mask id="sl-face-proof-mask-{{ section.id }}-{{ i }}" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="16" height="16">
                    <rect width="16" height="16" fill="currentColor"/>
                  </mask>
                  <g mask="url(#sl-face-proof-mask-{{ section.id }}-{{ i }})">
                    <path d="M6.01531 14.1539L4.90248 12.277L2.78465 11.8205L2.99231 9.63586L1.56415 8.00002L2.99231 6.36419L2.78465 4.17952L4.90248 3.72302L6.01531 1.84619L7.99998 2.68469L9.98465 1.84619L11.0975 3.72302L13.2153 4.17952L13.0076 6.36419L14.4358 8.00002L13.0076 9.63586L13.2153 11.8205L11.0975 12.277L9.98465 14.1539L7.99998 13.3154L6.01531 14.1539ZM7.29998 9.90519L10.6051 6.60003L10.1333 6.12052L7.29998 8.95386L5.86665 7.52819L5.39481 8.00002L7.29998 9.90519Z" fill="currentColor"/>
                  </g>
                </svg>
              </div>
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}
    </div>

    <div class="sl-overlap-text" style="font-size: {{ section.settings.font_size }}px;">
      {{ section.settings.richtext | replace: '<p', '<p class="sl-text-paragraph"' }}
    </div>
  </div>
</div>

<style>
  #sl-face-proof-bubble-{{ section.id }}.sl-overlap-section {
    display: flex;
    justify-content: center;
  }
  #sl-face-proof-bubble-{{ section.id }}.align-left-mobile {
    justify-content: flex-start;
  }
  #sl-face-proof-bubble-{{ section.id }}.align-center-mobile {
    justify-content: center;
  }
  #sl-face-proof-bubble-{{ section.id }}.align-right-mobile {
    justify-content: flex-end;
  }
  @media (min-width: 768px) {
    #sl-face-proof-bubble-{{ section.id }}.align-left-desktop {
      justify-content: flex-start;
    }
    #sl-face-proof-bubble-{{ section.id }}.align-center-desktop {
      justify-content: center;
    }
    #sl-face-proof-bubble-{{ section.id }}.align-right-desktop {
      justify-content: flex-end;
    }
  }
  #sl-face-proof-bubble-{{ section.id }} .sl-overlap-container {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 5px 20px 5px 10px;
    border-style: solid;
  }
  #sl-face-proof-bubble-{{ section.id }} .sl-overlap-images {
    display: flex;
    flex-wrap: nowrap;
    align-items: center;
    position: relative;
  }
  #sl-face-proof-bubble-{{ section.id }} .sl-overlap-img {
    position: relative;
    border-radius: 50%;
    overflow: visible;
    background: #fff;
  }
  #sl-face-proof-bubble-{{ section.id }} .sl-verify-badge {
    position: absolute;
    top: -10px;
    right: -10px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #sl-face-proof-bubble-{{ section.id }} .sl-overlap-text {
    max-width: 100%;
  }
</style>

{% schema %}
{
  "name": "SL Face Proof Bubble",
  "tag": "section",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "richtext",
      "id": "richtext",
      "label": "Text"
    },
    {
      "type": "checkbox",
      "id": "verification_badge",
      "label": "Enable verification badge",
      "default": false
    },
    {
      "type": "color",
      "id": "badge_color",
      "label": "Verification badge color",
      "default": "#2E9CF7"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Box background color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Image 1"
    },
    {
      "type": "image_picker",
      "id": "image_1",
      "label": "Image 1"
    },
    {
      "type": "color",
      "id": "img_1_border_color",
      "label": "Border color",
      "default": "#e1e1e1"
    },
    {
      "type": "range",
      "id": "img_1_border_width",
      "label": "Border width",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "px",
      "default": 2
    },
    {
      "type": "header",
      "content": "Image 2"
    },
    {
      "type": "image_picker",
      "id": "image_2",
      "label": "Image 2"
    },
    {
      "type": "color",
      "id": "img_2_border_color",
      "label": "Border color",
      "default": "#e1e1e1"
    },
    {
      "type": "range",
      "id": "img_2_border_width",
      "label": "Border width",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "px",
      "default": 2
    },
    {
      "type": "header",
      "content": "Image 3"
    },
    {
      "type": "image_picker",
      "id": "image_3",
      "label": "Image 3"
    },
    {
      "type": "color",
      "id": "img_3_border_color",
      "label": "Border color",
      "default": "#e1e1e1"
    },
    {
      "type": "range",
      "id": "img_3_border_width",
      "label": "Border width",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "px",
      "default": 2
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "align_desktop",
      "label": "Desktop alignment",
      "options": [
        { "value": "align-left-desktop", "label": "Left" },
        { "value": "align-center-desktop", "label": "Center" },
        { "value": "align-right-desktop", "label": "Right" }
      ],
      "default": "align-center-desktop"
    },
    {
      "type": "select",
      "id": "align_mobile",
      "label": "Mobile alignment",
      "options": [
        { "value": "align-left-mobile", "label": "Left" },
        { "value": "align-center-mobile", "label": "Center" },
        { "value": "align-right-mobile", "label": "Right" }
      ],
      "default": "align-center-mobile"
    },
    {
      "type": "range",
      "id": "space_top",
      "label": "Spacing top",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "space_bottom",
      "label": "Spacing bottom",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "space_sides",
      "label": "Spacing sides",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 0
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "range",
      "id": "font_size",
      "label": "Font size",
      "min": 10,
      "max": 30,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "range",
      "id": "image_size",
      "label": "Image size",
      "min": 16,
      "max": 128,
      "step": 2,
      "unit": "px",
      "default": 48
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border color",
      "default": "#e1e1e1"
    },
    {
      "type": "range",
      "id": "border_width",
      "label": "Border width",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "px",
      "default": 2
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "Border radius",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 8
    }
  ],
  "presets": [
    {
      "name": "SL Face Proof Bubble",
      "category": "Custom"
    }
  ]
}
{% endschema %}
