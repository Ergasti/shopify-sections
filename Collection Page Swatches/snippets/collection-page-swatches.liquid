{%- comment %}
  Renders color swatches for a product on collection page.
  Use inside collection product loop: {% render 'collection-page-swatches', product: product %}
  Requires product to have a Color (or Colour/Couleur) option.
{% endcomment -%}
{%- for option in product.options_with_values -%}
  {%- assign downcased_option = option.name | downcase -%}
  {%- if downcased_option == 'color' or downcased_option == 'colour' or downcased_option == 'couleur' -%}
    {%- assign variant_option = 'option' | append: forloop.index -%}
    {%- for value in option.values -%}
      {%- assign downcased_value = value | downcase | replace: ' ', '-' -%}
      {%- for variant in product.variants -%}
        {%- if variant[variant_option] == value -%}
          <a href="{{ variant.url }}" class="option_circle" style="background-color: {{ downcased_value | handle }};" title="{{ value }}" aria-label="{{ value }}"></a>
          {%- break -%}
        {%- endif -%}
      {%- endfor -%}
    {%- endfor -%}
    {%- break -%}
  {%- endif -%}
{%- endfor -%}

<style>
.option_circle {
  height: 25px;
  width: 25px;
  background-color: #bbb;
  border-radius: 50%;
  display: inline-block;
  border: 1px solid #ccc;
  margin: 0 2px;
}
</style>
